"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.encrypt=encrypt,exports.decrypt=decrypt;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));/**
 * webapi.js
 */function encrypt(){return _encrypt.apply(this,arguments)}function _encrypt(){return _encrypt=(0,_asyncToGenerator2.default)(/*#__PURE__*/_regenerator.default.mark(function a(b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p;return _regenerator.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(f=d.name,g=void 0===f?"AES-GCM":f,h=d.iv,i=d.additionalData,j=d.tagLength,"AES-GCM"===g&&(k=Object.assign({name:g,iv:h,tagLength:8*j},0<i.length?{additionalData:i}:{})),"undefined"!=typeof window.msCrypto){a.next=12;break}return a.next=5,e.importKey("raw",c,k,!1,["encrypt","decrypt"]);case 5:return l=a.sent,a.next=8,e.encrypt(k,l,b);case 8:return m=a.sent,a.abrupt("return",new Uint8Array(m));case 12:return a.next=14,msImportKey("raw",c,k,!1,["encrypt","decrypt"],e);case 14:return n=a.sent,a.next=17,msEncrypt(k,n,b,e);case 17:if(o=a.sent,"AES-GCM"!==g){a.next=23;break}return p=new Uint8Array(o.ciphertext.byteLength+o.tag.byteLength),p.set(new Uint8Array(o.ciphertext)),p.set(new Uint8Array(o.tag),o.ciphertext.byteLength),a.abrupt("return",p);case 23:case"end":return a.stop();}},a,this)})),_encrypt.apply(this,arguments)}function decrypt(){return _decrypt.apply(this,arguments)}// function definitions for IE
function _decrypt(){return _decrypt=(0,_asyncToGenerator2.default)(/*#__PURE__*/_regenerator.default.mark(function a(b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q;return _regenerator.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(f=d.name,g=void 0===f?"AES-GCM":f,h=d.iv,i=d.additionalData,j=d.tagLength,"AES-GCM"===g&&(k=Object.assign({name:g,iv:h,tagLength:8*j},0<i.length?{additionalData:i}:{})),window.msCrypto){a.next=12;break}return a.next=5,e.importKey("raw",c,k,!1,["encrypt","decrypt"]);case 5:return l=a.sent,a.next=8,e.decrypt(k,l,b).catch(function(){throw new Error("DecryptionFailure")});case 8:return m=a.sent,a.abrupt("return",new Uint8Array(m));case 12:return a.next=14,msImportKey("raw",c,k,!1,["encrypt","decrypt"],e);case 14:if(n=a.sent,"AES-GCM"!==g){a.next=22;break}return o=b.slice(0,b.length-j),p=b.slice(b.length-j,b.length),a.next=20,msDecrypt(Object.assign(k,{tag:p}),n,o,e).catch(function(){throw new Error("DecryptionFailure")});case 20:return q=a.sent,a.abrupt("return",new Uint8Array(q));case 22:case"end":return a.stop();}},a,this)})),_decrypt.apply(this,arguments)}var msImportKey=function(a,b,c,d,e,f){return new Promise(function(g,h){var i=f.importKey(a,b,c,d,e);i.oncomplete=function(a){g(a.target.result)},i.onerror=function(){h("KeyImportingFailed")}})},msEncrypt=function(a,b,c,d){return new Promise(function(e,f){var g=d.encrypt(a,b,c);g.oncomplete=function(a){e(a.target.result)},g.onerror=function(){f("EncryptionFailure")}})},msDecrypt=function(a,b,c,d){return new Promise(function(e,f){var g=d.decrypt(a,b,c);g.oncomplete=function(a){e(a.target.result)},g.onerror=function(){f("DecryptionFailure")}})};